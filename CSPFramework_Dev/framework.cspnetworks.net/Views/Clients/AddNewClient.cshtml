@model CSPLibrary.NewClientModel

@{
    ViewBag.Title = "Add New Client";
    Layout = "~/Views/Shared/_AdminLayout.cshtml";
}

<h2>Add New Client</h2>


<div class="col-sm-10">
    @using (Html.BeginForm("PostNewClient", "Clients", new { ReturnUrl = ViewBag.ReturnUrl }, FormMethod.Post, new { enctype = "multipart/form-data", @class = "form-horizontal", @id = "NewCustomerVendorForm" }))
    {

        <div class="modal-footer">
            <a href="/Clients/Index" class="btn">Cancel</a>
            <input type="submit" class="btn" value="Save" />
        </div>

        @Html.AntiForgeryToken()
        @Html.ValidationSummary(true)
        <div class="form-group">
            @Html.LabelFor(m => m.Client_Code, new { @class = "col-sm-3 control-label" })
            <div class="col-sm-8">
                @Html.TextBoxFor(m => m.Client_Code, new { @autofocus = "autofocus", @placeholder = "Enter Client Code" })
                @Html.ValidationMessageFor(m => m.Client_Code)
            </div>
        </div>

        <div class="form-group">
            @Html.LabelFor(m => m.Company_Name, new { @class = "col-sm-3 control-label" })
            <div class="col-sm-8">
                @Html.TextBoxFor(m => m.Company_Name, new { @autofocus = "autofocus", @placeholder = "Enter Company Name" })
                @Html.ValidationMessageFor(m => m.Company_Name)
            </div>
        </div>

        @*<div class="form-group">
            @Html.LabelFor(m => m.Address, new { @class = "col-sm-3 control-label" })
            <div class="col-sm-8">
                @Html.TextBoxFor(m => m.Address, new { @autofocus = "autofocus", @placeholder = "Enter Address" })
                @Html.ValidationMessageFor(m => m.Address)
            </div>
        </div>

        <div class="form-group">
            @Html.LabelFor(m => m.City, new { @class = "col-sm-3 control-label" })
            <div class="col-sm-8">
                @Html.TextBoxFor(m => m.City, new { @autofocus = "autofocus", @placeholder = "Enter City" })
                @Html.ValidationMessageFor(m => m.City)
            </div>
        </div>

        <div class="form-group">
            @Html.LabelFor(m => m.State, new { @class = "col-sm-3 control-label" })
            <div class="col-sm-8">
                @Html.EditorFor(m => m.State, "StateList", new { @autofocus = "autofocus" })
                @Html.ValidationMessageFor(m => m.State)
            </div>
        </div>

        <div class="form-group">
            @Html.LabelFor(m => m.Zip, new { @class = "col-sm-3 control-label" })
            <div class="col-sm-8">
                @Html.TextBoxFor(m => m.Zip, new { @autofocus = "autofocus", @class = "zip", @placeholder = "01001" })
                @Html.ValidationMessageFor(m => m.Zip)
            </div>
        </div>

        <div class="form-group">
            @Html.LabelFor(m => m.PhoneNumber, new { @class = "col-sm-3 control-label" })
            <div class="col-sm-8">
                @Html.TextBoxFor(m => m.PhoneNumber, new { @autofocus = "autofocus", @class = "phone", @placeholder = "999-999-9999" })
                @Html.ValidationMessageFor(m => m.PhoneNumber)
            </div>
        </div>

        <div class="form-group">
            @Html.LabelFor(m => m.MobileNumber, new { @class = "col-sm-3 control-label" })
            <div class="col-sm-8">
                @Html.TextBoxFor(m => m.MobileNumber, new { @autofocus = "autofocus", @class = "phone", @placeholder = "999-999-9999" })
                @Html.ValidationMessageFor(m => m.MobileNumber)
            </div>
        </div>*@

        <div class="form-group">
            @Html.LabelFor(m => m.ServiceType, new { @class = "col-sm-3 control-label" })
            <div class="col-sm-8">
                @Html.DisplayFor(m => m.ServiceType, "ServicesList", new { @autofocus = "autofocus" })
                @Html.ValidationMessageFor(m => m.ServiceType)
            </div>
        </div>

        <div class="form-group">
            @Html.LabelFor(m => m.Website, new { @class = "col-sm-3 control-label" })
            <div class="col-sm-8">
                @Html.TextBoxFor(m => m.Website, new { @autofocus = "autofocus", @placeholder = @"http://www.example.com" })
                @Html.ValidationMessageFor(m => m.Website)
            </div>
        </div>

        <div class="form-group">
            <div class="panel-group" id="agreementsSec_" style="margin-left: 26.5%;margin-right: 10%;">
                <div class="panel">

                    <div class="panel-heading" style="background-color:grey">
                        <h4 class="panel-title">
                            @*<a data-toggle="collapse" data-parent="#agreementsSec_" href="#agreementsSecChild_">*@
                            <strong style="color:black">
                                Agreement
                            </strong>
                            @*</a>*@
                        </h4>
                    </div>
                    <div id="agreementsSecChild_" class="panel-group">
                        <div class="panel-body">

                            <div class="form-group">
                                @Html.LabelFor(m => m.AgreementStartDate, new { @class = "col-sm-3 control-label" })
                                <div class="row">
                                    <div class="container">
                                        <div class="col-sm-8">
                                            <div class='input-group date' id="startDate_">
                                                @Html.TextBoxFor(m => m.AgreementStartDate, new { @class = "form-control", @placeholder = "01/25/2014" })
                                                <span class="input-group-addon">
                                                    <span class="glyphicon glyphicon-calendar"></span>
                                                </span>
                                            </div>
                                            @Html.ValidationMessageFor(m => m.AgreementStartDate)
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="form-group">
                                @Html.LabelFor(m => m.AgreementEndDate, new { @class = "col-sm-3 control-label" })
                                <div class="row">
                                    <div class="container">
                                        <div class="col-sm-8">
                                            <div class='input-group date' id="endDate_">
                                                @Html.TextBoxFor(m => m.AgreementEndDate, new { @class = "form-control", @placeholder = "01/25/2014" })
                                                <span class="input-group-addon">
                                                    <span class="glyphicon glyphicon-calendar"></span>
                                                </span>
                                            </div>
                                            @Html.ValidationMessageFor(m => m.AgreementEndDate)
                                        </div>
                                    </div>
                                </div>
                            </div>

                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="form-group">
        </div>

        <div class="form-group">
            @Html.LabelFor(m => m.Team, new { @class = "col-sm-3 control-label" })
            <div class="col-sm-8">
                @Html.EditorFor(m => m.Team, "TeamList")
                @Html.ValidationMessageFor(m => m.Team)
            </div>
        </div>

        <div class="form-group">
            @Html.LabelFor(m => m.Status, new { @class = "col-sm-3 control-label" })
            <div class="col-sm-8">
                @Html.EditorFor(m => m.Status, "UserStatus")
                @Html.ValidationMessageFor(m => m.Status)
            </div>
        </div>

        <div class="form-group">            
            @*<div class="col-sm-8">*@
                @Html.TextBoxFor(m => m.Sites, new { @placeholder = "Enter Sites", @style = "display:none" })               
            @*</div>*@
            <div class="panel-group" id="clientSitePanel_" style="margin-left: 26.5%;margin-right: 10%;">
                <div class="panel">
                    <div class="panel-heading" style="background-color:grey">
                        <h4 class="panel-title">
                            <strong style="color:black">
                                Client Sites
                            </strong>
                            @*</a>*@
                        </h4>
                    </div>
                    <div class="panel-group">
                        <div class="panel-body">
                            <div id="SitesPanel"></div>
                            <input id="AddNew_btn" type="button" class="btn col-md-5" value="Add More Sites" />
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="form-group">
            

        </div>

        <div class="modal-footer">
            <a href="/Clients/Index" class="btn">Cancel</a>
            <input type="submit" class="btn" value="Save" />
        </div>
    }

</div>

@section Scripts {
    @Scripts.Render("~/bundles/jqueryval")
    @Scripts.Render("~/bundles/jquery")
    @Styles.Render("~/Content/admin/css")
    @Scripts.Render("~/bundles/maskedEdit")
    @Scripts.Render("~/bundles/moment")
    @Scripts.Render("~/bundles/bootstrap-datepicker")
    @Styles.Render("~/bundles/bootstrap-datepicker-css")

    <script>
        $(document).ready(function () {
            // Initialize datepicker
            $("#startDate_").datetimepicker({
                pickTime: false
            });
            $("#endDate_").datetimepicker({
                pickTime: false
            });
            $("#startDate_").on("dp.change", function (e) {
                $('#endDate_').data("DateTimePicker").setMinDate(e.date);
            });
            $("#endDate_").on("dp.change", function (e) {
                $('#startDate_').data("DateTimePicker").setMaxDate(e.date);
            });

            // Maked Edit Controls
            jQuery(function ($) {
                $(".phone").mask("000.000.0000");
                $(".zip").mask("00000");
            });
        });
    </script>

    <script>
        function createElement(tagName) {
            return document.createElement(tagName);
        }

        function appendChild(parent, child) {
            parent.appendChild(child);
        }       

        function createFormGroupDiv(labelText, className) {
            
            var input = createElement('input');
            $(input).attr("class", className);
            var label = createElement('label');
            label.innerHTML = labelText;
            $(label).attr('class', 'control-label col-md-3');

            var formDiv = createElement('div');
            $(formDiv).attr('class', 'form-group');

            var formChild = createElement('div');
            $(formChild).attr('class', 'col-sm-8');
            appendChild(formChild, input);
            appendChild(formDiv, label);
            appendChild(formDiv, formChild);
            return formDiv;
        }
        function createSiteDiv(id) {

            var siteDiv = createElement('div');
            $(siteDiv).attr('id', id);
            $(siteDiv).attr('class', 'panel');
            $(siteDiv).attr('style', 'border-width:thin;border-color:gray;margin-bottom:2%;');

            var panelHeadingDiv = createElement('div');
            $(panelHeadingDiv).attr('style', "background-color:dimgray");
            $(panelHeadingDiv).attr('class', 'panel-heading');
            panelHeadingDiv.innerHTML = "<h4 class='panel-title'><strong style='color:black;'>Site Information</strong></h4>";

            var panelGroup = createElement('div');
            $(panelGroup).attr('class', 'panel-group');

            var boostrapDiv = createElement('div');
            $(boostrapDiv).attr('class', 'panel-body');

            var addressDiv = createFormGroupDiv('Address', 'address');
            var cityDiv = createFormGroupDiv('City', 'city');
            var stateDiv = createFormGroupDiv('State', 'state');
            var zipDiv = createFormGroupDiv('Zip', 'zip');
            var phoneNoDiv = createFormGroupDiv('Phone Number', 'phNumber');
            var mobNoDiv = createFormGroupDiv('Fax', 'mobNumber');
            var removeBtn = createElement('input');
            $(removeBtn).attr('type', 'button');
            $(removeBtn).attr('class', 'btn col-md-offset-8 col-md-3');
            $(removeBtn).attr('value', 'Reomve');
            $(removeBtn).attr('style', 'margin-bottom: 15px;');
            $(removeBtn).click(function () {
                $(siteDiv).remove();
            });

            appendChild(boostrapDiv, addressDiv);
            appendChild(boostrapDiv, cityDiv);
            appendChild(boostrapDiv, stateDiv);
            appendChild(boostrapDiv, zipDiv);
            appendChild(boostrapDiv, phoneNoDiv);
            appendChild(boostrapDiv, mobNoDiv);
            appendChild(boostrapDiv, removeBtn);

            appendChild(panelGroup, boostrapDiv);
            appendChild(siteDiv, panelHeadingDiv);
            appendChild(siteDiv, panelGroup);
            
            return siteDiv;
        }
        var idSuffix = 1;
        $("#SitesPanel").append(createSiteDiv('Sites1'));

        $('#AddNew_btn').click(function () {
            idSuffix++;
            var id = "Sites" + idSuffix;
            var siteDiv = createSiteDiv(id);
            $("#SitesPanel").append(siteDiv);
            setTimeout(window.scrollTo(0, document.body.scrollHeight), 1000);
        });

        function fetchAllInputs() {
            var allSites = [];
            for (var i = 1; i <= idSuffix; i++) {
                var elementID = "Sites" + i;
                if ($("#" + elementID + "").length != 0) {
                    var sites = {
                        Address: {},
                        City: {},
                        State: {},
                        Zip: {},
                        PhoneNumber: {},
                        FaxNumber: {}
                    };
                    sites.Address = $("#" + elementID + " .address").val();
                    sites.City = $("#" + elementID + " .city").val();
                    sites.State = $("#" + elementID + " .state").val();
                    sites.Zip = $("#" + elementID + " .zip").val();
                    sites.PhoneNumber = $("#" + elementID + " .phNumber").val();
                    sites.FaxNumber = $("#" + elementID + " .mobNumber").val();

                    allSites.push(sites);
                }
            }
            console.log(JSON.stringify(allSites));
            return JSON.stringify(allSites);
        }
        $('#NewCustomerVendorForm').submit(function () {
            $('[name="Sites"]').val(fetchAllInputs());

        });
    </script>
}
